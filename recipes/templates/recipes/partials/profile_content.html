{% load static %}
<div class="container profile-page">
  <!-- –®–∞–ø–∫–∞ –ø—Ä–æ—Ñ—ñ–ª—é -->
  <section class="profile-header">
    <h1>–ú—ñ–π –∫—É–ª—ñ–Ω–∞—Ä–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å</h1>
    <p>–ö–µ—Ä—É–π—Ç–µ —Å–≤–æ—ó–º–∏ —Ä–µ—Ü–µ–ø—Ç–∞–º–∏ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏</p>
  </section>

  <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ -->
  <section class="profile-info">
    {% if user.profile_picture %}
    <img src="{{ user.profile_picture.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="profile-avatar">
    {% else %}
    <img src="{% static 'recipes/default-avatar.png' %}" alt="–ê–≤–∞—Ç–∞—Ä" class="profile-avatar">
    {% endif %}

    <div class="user-details">
      <p><strong>–ù—ñ–∫–Ω–µ–π–º:</strong> {{ user.username }}</p>
      <p><strong>–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó:</strong> {{ user.date_joined|date:"d.m.Y" }}</p>

      <button id="editBtn" class="btn btn-primary" style="margin-top: 15px;">
        <i class="fas fa-edit"></i> –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å
      </button>
    </div>

    <div class="profile-stats" style="height: 40px;">
      <div class="stat-item">
        <div class="stat-value">{{ recipes.count }}</div>
        <div class="stat-label">–†–µ—Ü–µ–ø—Ç—ñ–≤</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ avg_rating|default:"0.0" }}
          {% for i in "12345" %}
            {% with num=i|add:"0" %}
              <i class="fa-star {% if avg_rating >= num %}fas{% else %}far{% endif %}"></i>
            {% endwith %}
          {% endfor %}
        </div>
        <div class="stat-label">–°–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–π—Ç–∏–Ω–≥</div>
      </div>
    </div>
  </section>

  <!-- –ú–æ—ó —Ä–µ—Ü–µ–ø—Ç–∏ -->
  <section id="my-recipes">
    <h2 class="section-title"><i class="fas fa-book-open"></i> –ú–æ—ó —Ä–µ—Ü–µ–ø—Ç–∏</h2>

    {% if recipes %}
    <div class="recipes-grid">
      {% for recipe in recipes|slice:":4" %}
      <div class="recipe-card">
        <div class="recipe-img-container">
          {% if recipe.image %}
          <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="recipe-img">
          {% else %}
          <div class="no-image"><i class="fas fa-utensils fa-2x"></i></div>
          {% endif %}
        </div>

        <div class="recipe-content">
          <h3 class="recipe-title">{{ recipe.title }}</h3>
          <p class="recipe-meta">
            <i class="fas fa-calendar-alt"></i> {{ recipe.created_at|date:"d.m.Y" }}
            <i class="fas fa-star"></i> {{ recipe.rating|default:"0.0" }}
          </p>

          <div class="recipe-actions">
            <a href="{% url 'recipe_detail' recipe.pk %}" class="btn btn-primary">
              <i class="fas fa-eye"></i>
            </a>
            <a href="{% url 'edit_recipe' recipe.pk %}" class="btn btn-edit">
              <i class="fas fa-edit"></i>
            </a>
            <a href="{% url 'delete_recipe' recipe.pk %}" class="btn btn-delete">
              <i class="fas fa-trash"></i>
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    {% if recipes|length > 4 %}
    <div style="text-align: center; margin-top: 20px;">
      <a href="{% url 'user_recipes' user.username %}" class="btn btn-primary">
        <i class="fas fa-list"></i> –í—Å—ñ –º–æ—ó —Ä–µ—Ü–µ–ø—Ç–∏ ({{ recipes.count }})
      </a>
    </div>
    {% endif %}

    {% else %}
    <div class="empty-profile" style="text-align: center; padding: 40px; background: var(--card-bg); border-radius: 15px;">
      <p style="font-size: 1.2rem; margin-bottom: 20px;">–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î —Ä–µ—Ü–µ–ø—Ç—ñ–≤ ü•≤</p>
      <a href="{% url 'add_recipe' %}" class="btn btn-primary">
        <i class="fas fa-plus"></i> –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—à–∏–π —Ä–µ—Ü–µ–ø—Ç
      </a>
    </div>
    {% endif %}
  </section>

  <!-- –ó–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏ -->
  <section id="saved-recipes" style="margin-top: 50px;">
    <h2 class="section-title"><i class="fas fa-bookmark"></i> –ó–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏</h2>

    {% if saved_recipes %}
    <div class="recipes-grid">
      {% for recipe in saved_recipes|slice:":4" %}
      <div class="recipe-card">
        <div class="recipe-img-container">
          {% if recipe.image %}
          <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="recipe-img">
          {% else %}
          <div class="no-image"><i class="fas fa-utensils fa-2x"></i></div>
          {% endif %}
        </div>

        <div class="recipe-content">
          <h3 class="recipe-title">{{ recipe.title }}</h3>
          <p class="recipe-meta">
            <i class="fas fa-user"></i> {{ recipe.author.username }}
            <i class="fas fa-calendar-alt"></i> {{ recipe.created_at|date:"d.m.Y" }}
          </p>

          <div class="recipe-actions">
            <a href="{% url 'recipe_detail' recipe.pk %}" class="btn btn-primary">
              <i class="fas fa-eye"></i> –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    {% if saved_recipes|length > 4 %}
    <div style="text-align: center; margin-top: 20px;">
      <a href="{% url 'saved_recipes' %}" class="btn btn-primary">
        <i class="fas fa-list"></i> –í—Å—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏ ({{ saved_recipes.count }})
      </a>
    </div>
    {% endif %}

    {% else %}
    <div class="empty-profile" style="text-align: center; padding: 40px; background: var(--card-bg); border-radius: 15px;">
      <p style="font-size: 1.2rem;">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ üòê</p>
    </div>
    {% endif %}
  </section>

  <!-- –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∞–∫–∞—É–Ω—Ç–æ–º -->
  <section class="account-management" style="margin-top: 50px;">
    <h3><i class="fas fa-cog"></i> –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∞–∫–∞—É–Ω—Ç–æ–º</h3>

    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
      <button id="changePasswordBtn" class="btn btn-edit">
        <i class="fas fa-key"></i> ‚ö†Ô∏è —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
      </button>

      <button id="deleteAccountBtn" class="btn btn-delete">
        <i class="fas fa-user-slash"></i> –í–∏–¥–∞–ª–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç
      </button>
    </div>

    <div id="confirmationDialog" class="confirmation-dialog">
      <p><strong>–£–≤–∞–≥–∞!</strong> –í–∏ –¥—ñ–π—Å–Ω–æ –±–∞–∂–∞—î—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç? –¶—è –¥—ñ—è —î –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω–æ—é.</p>
      <form method="POST" action="{% url 'delete_account' %}" id="deleteAccountForm">
        {% csrf_token %}
        <button type="submit" class="btn btn-delete">
          <i class="fas fa-check"></i> –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
        </button>
        <button type="button" class="btn btn-primary" id="cancelDeleteBtn">
          <i class="fas fa-times"></i> –°–∫–∞—Å—É–≤–∞—Ç–∏
        </button>
      </form>
    </div>
  </section>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" id="closeModal">&times;</span>
    <h2><i class="fas fa-user-edit"></i> –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é</h2>

    <form method="POST" action="{% url 'edit_profile' %}" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="form-group">
        <label for="username">–ù—ñ–∫–Ω–µ–π–º</label>
        <input type="text" id="username" name="username" value="{{ user.username }}" required>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" value="{{ user.email }}" required>
      </div>

      <div class="form-group">
        <label for="avatar">–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é</label>
        <input type="file" id="avatar" name="avatar" accept="image/*">
      </div>

      <div style="display: flex; gap: 15px; margin-top: 25px;">
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save"></i> –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏
        </button>
        <button type="button" class="btn btn-delete" id="cancelEdit">
          <i class="fas fa-times"></i> –°–∫–∞—Å—É–≤–∞—Ç–∏
        </button>
      </div>
    </form>
  </div>
</div>

<script>
// –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é
document.getElementById('editBtn').addEventListener('click', function() {
  document.getElementById('editModal').style.display = 'block';
});

document.getElementById('closeModal').addEventListener('click', function() {
  document.getElementById('editModal').style.display = 'none';
});

document.getElementById('cancelEdit').addEventListener('click', function() {
  document.getElementById('editModal').style.display = 'none';
});

// –í–∏–¥–∞–ª–µ–Ω–Ω—è –∞–∫–∞—É–Ω—Ç—É
document.getElementById('deleteAccountBtn').addEventListener('click', function() {
  document.getElementById('confirmationDialog').style.display = 'block';
});

document.getElementById('cancelDeleteBtn').addEventListener('click', function() {
  document.getElementById('confirmationDialog').style.display = 'none';
});

// –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
window.addEventListener('click', function(event) {
  if (event.target == document.getElementById('editModal')) {
    document.getElementById('editModal').style.display = 'none';
  }
});
</script>
