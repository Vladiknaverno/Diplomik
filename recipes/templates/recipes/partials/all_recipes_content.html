{% load static %}
<script src="{% static 'js/all_recipes.js' %}"></script>

<div class="page-header">
    <h1 class="page-title">–£—Å—ñ —Ä–µ—Ü–µ–ø—Ç–∏</h1>
    <p class="page-subtitle">–û–±–µ—Ä—ñ—Ç—å, —Ñ—ñ–ª—å—Ç—Ä—É–π—Ç–µ —Ç–∞ –¥–æ—Å–ª—ñ–¥–∂—É–π—Ç–µ –≤—Å—ñ –Ω–∞—à—ñ —Å—Ç—Ä–∞–≤–∏</p>

    <!-- üîç –§–æ—Ä–º–∞ –ø–æ—à—É–∫—É -->
    <form method="get" action="{% url 'all_recipes' %}" style="margin: 20px 0;">
        <input type="text" name="q" placeholder="–ü–æ—à—É–∫ —Ä–µ—Ü–µ–ø—Ç—ñ–≤..."
               value="{{ request.GET.q }}" class="form-control" style="display:inline-block; width: 75%;" />
        <button type="submit" class="btn btn-primary" style="display:inline-block;">–ü–æ—à—É–∫</button>

        {% for cat in selected_categories %}
            <input type="hidden" name="category" value="{{ cat }}">
        {% endfor %}
        {% if sort %}
            <input type="hidden" name="sort" value="{{ sort }}">
        {% endif %}
    </form>

    <!-- –ë–ª–æ–∫ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è -->
    <div class="sort-filter-bar">
      <div class="sort-buttons">
        <a href="?sort=newest"
           hx-get="?sort=newest"
           hx-target="#main-content"
           hx-push-url="true"
           class="btn {% if sort == 'newest' %}active{% endif %}">
           –ù–∞–π–Ω–æ–≤—ñ—à—ñ
        </a>

        <a href="?sort=popular"
           hx-get="?sort=popular"
           hx-target="#main-content"
           hx-push-url="true"
           class="btn {% if sort == 'popular' %}active{% endif %}">
           –ü–æ–ø—É–ª—è—Ä–Ω—ñ
        </a>

        <a href="?sort=oldest"
           hx-get="?sort=oldest"
           hx-target="#main-content"
           hx-push-url="true"
           class="btn {% if sort == 'oldest' %}active{% endif %}">
           –ù–∞–π—Å—Ç–∞—Ä—ñ—à—ñ
        </a>
      </div>
    </div>

</div>

<div class="content-wrapper">
  <!-- –°–∞–π–¥–±–∞—Ä –∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ -->
  <aside class="filters-sidebar">
    <form method="get"
          id="filtersForm"
          hx-get="{% url 'all_recipes' %}"
          hx-target="#main-content"
          hx-push-url="true"
          class="recipe-filter-form">

      <div class="filters-scrollable">
        <div class="filter-group">
          <label for="category">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó:</label>
          {% for main_cat in main_categories %}
            <div class="category-group">
              <div class="main-category">
                {{ main_cat.name }} <i class="fas fa-chevron-down"></i>
              </div>
              <div class="subcategories">
                {% for sub_cat in main_cat.children.all %}
                  <label class="category-option">
                    <input type="checkbox" name="category" value="{{ sub_cat.id }}"
                           {% if sub_cat.id|stringformat:"s" in selected_categories %}checked{% endif %}>
                    <span>{{ sub_cat.name }}</span>
                  </label>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞ –º–µ–∂–∞–º–∏ —Å–∫—Ä–æ–ª-–∑–æ–Ω–∏ -->
      <div class="sticky-reset-btn" style="width: 230px;">
        <a href="{% url 'all_recipes' %}"
           class="submit-btn"
           hx-get="{% url 'all_recipes' %}"
           hx-target="#main-content"
           hx-push-url="true">
           <i class="fas fa-times-circle"></i> –°–∫–∏–Ω—É—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏
        </a>
      </div>
    </form>
  </aside>

  <!-- –û—Å–Ω–æ–≤–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ –∑ —Ä–µ—Ü–µ–ø—Ç–∞–º–∏ -->
  <main class="recipes-main">
    <div class="recipes-grid">
      {% if page_obj %}
        {% for recipe in page_obj %}
          <div class="recipe-card">
            <div class="recipe-img-container">
              {% if recipe.image %}
              <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="recipe-img">
              {% else %}
              <div style="background: #333; height: 100%; display: flex; align-items: center; justify-content: center; color: #777;">
                <i class="fas fa-utensils" style="font-size: 3rem;"></i>
              </div>
              {% endif %}
            </div>
            <div class="recipe-content">
              <h3 class="recipe-title">{{ recipe.title }}</h3>
              <p class="recipe-meta">
                –ê–≤—Ç–æ—Ä: {{ recipe.author.username }} ‚Ä¢ {{ recipe.created_at|date:"d.m.Y" }}
              </p>
              <a href="{% url 'recipe_detail' recipe.pk %}" class="btn">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="no-recipes-wrapper">
          <div class="no-recipes">
            –ù–µ–º–∞—î —Ä–µ—Ü–µ–ø—Ç—ñ–≤ –∑–∞ –≤–∏–±—Ä–∞–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ üôÅ
          </div>
        </div>
      {% endif %}
    </div>


    <div class="pagination">
      {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}" class="btn">–ü–æ–ø–µ—Ä–µ–¥–Ω—è</a>
      {% endif %}
      <span class="page-number">–°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page_obj.number }} –∑ {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}" class="btn">–ù–∞—Å—Ç—É–ø–Ω–∞</a>
      {% endif %}
    </div>
  </main>
</div>
